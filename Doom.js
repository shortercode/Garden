/* Doom.js Library Version: 1.2.0 Copyright (c) 2015 Iain Shorter */window.Doom = {}; (function() {'use strict';if(!("classList"in document.createElement("_"))&&"Element"in window){var classListProp="classList",protoProp="prototype",elemCtrProto=window.Element[protoProp],objCtr=Object,strTrim=String[protoProp].trim||function(){return this.replace(/^\s+|\s+$/g,"")},arrIndexOf=Array[protoProp].indexOf||function(c){for(var a=0,b=this.length;a<b;a++)if(a in this&&this[a]===c)return a;return-1},DOMEx=function(c,a){this.name=c;this.code=DOMException[c];this.message=a},checkTokenAndGetIndex=function(c,a){if(""===
a)throw new DOMEx("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(a))throw new DOMEx("INVALID_CHARACTER_ERR","String contains an invalid character");return arrIndexOf.call(c,a)},ClassList=function(c){for(var a=strTrim.call(c.getAttribute("class")||""),a=a?a.split(/\s+/):[],b=0,e=a.length;b<e;b++)this.push(a[b]);this._updateClassName=function(){c.setAttribute("class",this.toString())}},classListProto=ClassList[protoProp]=[],classListGetter=function(){return new ClassList(this)};
DOMEx[protoProp]=Error[protoProp];classListProto.item=function(c){return this[c]||null};classListProto.contains=function(c){return-1!==checkTokenAndGetIndex(this,c+"")};classListProto.add=function(c){c+="";-1===checkTokenAndGetIndex(this,c)&&(this.push(c),this._updateClassName())};classListProto.remove=function(c){var a;c+="";for(a=checkTokenAndGetIndex(this,c);-1!==a;)this.splice(a,1),this._updateClassName(),a=checkTokenAndGetIndex(this,c)};classListProto.toggle=function(c){c+="";var a=this.contains(c);
this[a?"remove":"add"](c);return!a};classListProto.toString=function(){return this.join(" ")};if(objCtr.defineProperty){var classListPropDesc={get:classListGetter,enumerable:!0,configurable:!0};try{objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc)}catch(ex){-2146823252===ex.number&&(classListPropDesc.enumerable=!1,objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc))}}else objCtr[protoProp].__defineGetter__&&elemCtrProto.__defineGetter__(classListProp,classListGetter)};if(!Promise in window){var Promise=function(c){if(this instanceof Promise)this.state=STATE_INIT,this.subscriberqueue=[],this.settledValue=this.resolvehandler=this.rejectionhandler=void 0,c!==INTERNAL&&this.resolveWithResolver(c);else return new Promise(c)},deferredThrow=function(c){setTimeout(function(){throw c;},0)},tryCatch=function(c){return function(a,b){try{return c(a,b)}catch(e){return errorObj.e=e,errorObj}}},errorObj={e:null},STATE_INIT=0,STATE_PEND=1,STATE_RSLV=2,STATE_RJCT=3,INTERNAL=function(){};
Promise.prototype={resolveWithResolver:function(c){var a=this;this.state=STATE_PEND;c=tryCatch(c)(function(b){null!==a&&(a.resolveCallback(b),a=null)},function(b){null!==a&&(a.rejectCallback(b),a=null)});void 0!==c&&null!==a&&(a.rejectCallback(c.e),a=null)},resolveCallback:function(c){var a=this;c instanceof Promise?c.then(function(b){null!==a&&(a.resolveCallback(b),a=null)},function(b){null!==a&&(a.rejectCallback(b),a=null)}):(this.state=STATE_RSLV,this.resolvehandler?(c=tryCatch(this.resolvehandler)(c),
c===errorObj?a.reject(c.e):c instanceof Promise?c.then(function(b){null!==a&&(a.fulfill(b),a=null)},function(b){null!==a&&(a.reject(b),a=null)}):a.fulfill(c)):this.fulfill(c))},rejectCallback:function(c){var a=this;c instanceof Promise?c.then(function(b){null!==a&&(a.resolveCallback(b),a=null)},function(b){null!==a&&(a.rejectCallback(b),a=null)}):(this.state=STATE_RJCT,this.rejectionhandler?(c=tryCatch(this.rejectionhandler)(c),c===errorObj?(a.reject(c.e),a=null):c instanceof Promise?c.then(function(b){a.fulfill(b);
a=null},function(b){a.reject(b);a=null}):(a.fulfill(c),a=null)):this.reject(c))},fulfill:function(c){for(var a=this,b;this.subscriberqueue.length;)b=this.subscriberqueue.shift(),setTimeout(function(){b.resolveCallback(c);a.settledValue=c},0)},reject:function(c,a){for(var b=this,e;this.subscriberqueue.length;)e=this.subscriberqueue.shift(),setTimeout(function(){e.rejectCallback(c);b.settledValue=c},0)},then:function(c,a){var b=new Promise(INTERNAL);b.resolvehandler=c;b.rejectionhandler=a;this.subscriberqueue.push(b);
this.settledValue&&(this.state===STATE_RSLV?this.fulfill(this.settledValue):this.reject(this.settledValue));return b},catch:function(c){return this.then(void 0,c)}}}Doom.Promise=Promise;Element.prototype.contains||(Element.prototype.contains=function(c){return!!(this.compareDocumentPosition(c)&16)});var alloys={};function createAlloy(c,a){c=c.toLowerCase();if(alloys[c]){var b=new alloys[c](a);b.alloyName=c;b.element.alloy=b;return b.element}throw Error('Construction Error, alloy "'+c+'" does not exist');}Doom.define=function(c,a){c=c.toLowerCase();if(alloys[c])throw Error('Definition Error, alloy "'+c+'" already exists!');alloys[c]=a};(function(){function c(b){var c,f;if("object"!==typeof b)throw Error("Element object structure is not defined");f="string"===typeof b.alloyName||"string"===typeof b.alloy?createAlloy(b.alloyName||b.alloy,b.alloyProperties||{}):document.createElement(b.tagName||"div");for(c in b)c in a?a[c].apply(f,[b[c]]):f[c]=b[c];return f}var a={};a.tagName=a.alloy=a.alloyName=a.alloyProperties=a.copies=function(){};a.onTap=a.ontap=function(b){return Doom.touch(this,"tap",b)};a.onSwipe=a.onswipe=function(b){return Doom.touch(this,
"swipe",b)};a.onhold=a.onHold=function(b){return Doom.touch(this,"hold",b)};a.onpan=a.onPan=function(b){return Doom.touch(this,"pan",b)};a.ontouchstart=a.onTouchStart=function(b){return Doom.touch(this,"touchstart",b)};a.ontouchend=a.onTouchEnd=function(b){return Doom.touch(this,"touchend",b)};a.parentNode=a.parent=function(b){return b.appendChild(this)};a.insertBefore=function(b){b.parentNode.insertBefore(this,b)};a.insertAfter=function(b){b.nextSibling?b.parentNode.insertBefore(this,b.nextSibling):
b.parentNode.appendChild(this)};a.insertFirst=function(b){b.insertBefore(this,b.firstChild)};a.style=function(b){if("object"===typeof b)for(var a in b)this.style[a]=b[a];else if("string"===typeof b)this.style.cssText+=b;else throw Error("Style TypeError - "+typeof b);};a.childNodes=a.children=function(b){for(var c=0;c<b.length;c++)b[c]=a.child.apply(this,[b[c]]);return b};a.child=function(b){if(b instanceof HTMLElement)this.appendChild(b);else if("object"===typeof b)b.parentNode=this,b=c(b);else throw Error("Child TypeError - "+
typeof b);return b};a.dataset=function(b){for(var a in b)this.dataset[a]=b[a]};Doom.create=c})();function Service(){this.delegates=[];this.eventlist={}}
Service.prototype={on:function(c,a){this.eventlist[c]=a},fire:function(c,a){"function"===typeof this.eventlist[c]&&this.eventlist[c].call(this,a)},register:function(c){c=new Delegate(this,c);this.delegates.push(c);1===this.delegates.length&&this.fire("start");this.fire("register",c);return c},deregister:function(c){var a=this.delegates.indexOf(c);this.delegates.splice(a,1);this.fire("deregister",c);0===this.delegates.length&&this.fire("stop")},callDelegates:function(c,a){for(var b=this.delegates.length;b--;)this.delegates[b].fire(c,
a)}};function Delegate(c,a){this.eventlist={};this.service=c;this.context=a}Delegate.prototype={on:function(c,a){this.eventlist[c]=a;this.service.fire("listen",[c,this])},fire:function(c,a){"function"===typeof this.eventlist[c]&&this.eventlist[c].call(this.context,a)}};Doom.service=function(){return new Service};(function(){function c(b){var a=[];for(i in b)a.push(i+"="+escape(encodeURI(b[i])));return a.join("&")}function a(a,c){for(var l in b.headers)void 0===c[l]&&(c[l]=b.headers[l]);for(l in c)a.setRequestHeader(l,c[l])}var b={method:"GET",encode:"json",timeout:0,credentials:!0,headers:{Accept:"*/*","Content-type":"application/json;charset=UTF-8"}};Doom.fetch=function(e){return new Doom.Promise(function(f,l){var k=new XMLHttpRequest,q=e.encode||b.encode,s=e.timeout||b.timeout,m=e.withCredentials||b.credentials,
g=e.headers||{};k.open(e.method||b.method,"string"===typeof e?e:e.url);k.timeout=s;k.withCredentials=m;a(k,g);k.onload=function(){400>k.status&&200<=k.status?f(k.response):l(k)};k.onerror=function(){l(k)};k.onabort=function(){l(k)};"json"===q?k.send(e.data?JSON.stringify(e.data):null):"url"===q&&k.send(e.data?c(e.data):null)})};Doom.fetch.DEFAULTS=b})();(function(){function c(b){var e=b.element,f,l;if(e){if(!1===e instanceof HTMLElement&&e[0]){f=0;for(l=~~e.length;f<l;f++)b.element=e[f],c(b);return e}if(e instanceof HTMLElement)if(b.delay)f=b.delay,b.delay=null,setTimeout(c,f,b);else{for(f in b)f in a?a[f].apply(e,[b[f]]):e[f]=b[f];return e}else throw Error("Element TypeError - "+typeof e);}else throw Error("Element not defined");}var a={};a.tagName=a.alloyName=a.alloyProperties=a.copies=function(){};a.onTap=a.ontap=function(b){return Doom.touch(this,
"tap",b)};a.onSwipe=a.onswipe=function(b){return Doom.touch(this,"swipe",b)};a.onhold=a.onHold=function(b){return Doom.touch(this,"hold",b)};a.onpan=a.onPan=function(b){return Doom.touch(this,"pan",b)};a.ontouchstart=a.onTouchStart=function(b){return Doom.touch(this,"touchstart",b)};a.ontouchend=a.onTouchEnd=function(b){return Doom.touch(this,"touchend",b)};a.parentNode=a.parent=function(b){return b.appendChild(this)};a.insertBefore=function(b){b.parentNode.insertBefore(this,b)};a.insertAfter=function(b){b.nextSibling?
b.parentNode.insertBefore(this,b.nextSibling):b.parentNode.appendChild(this)};a.insertFirst=function(b){b.insertBefore(this,b.firstChild)};a.style=function(b){if("object"===typeof b)for(var a in b)this.style[a]=b[a];else if("string"===typeof b)this.style.cssText+=b;else throw Error("Style TypeError - "+typeof b);};a.addClass=function(b){this.classList.add(b)};a.toggleClass=function(b){this.classList.toggle(b)};a.removeClass=function(b){this.classList.remove(b)};a.childNodes=a.children=function(b){for(;this.firstChild;)this.removeChild(this.firstChild);
for(var a=0;a<b.length;a++)if(b[a]instanceof HTMLElement)this.appendChild(b[a]);else if("string"===typeof b[a])for(var c=Doom.create({innerHTML:b[a]});c.firstChild;)this.appendChild(c.firstChild);else if("object"===typeof b[a])b[a].parentNode=this,b[a]=Doom.create(b[a]);else throw Error("Child TypeError - "+typeof b[a]);return b};a.child=function(a){for(;this.firstChild;)this.removeChild(this.firstChild);if(a instanceof HTMLElement)this.appendChild(a);else if("string"===typeof a)for(var c=Doom.create({innerHTML:a});c.firstChild;)this.appendChild(c.firstChild);
else if("object"===typeof a)a.parentNode=this,a=Doom.create(a);else throw Error("Child TypeError - "+typeof a[i]);return a};a.removeChild=function(a){"number"===typeof a?this.removeChild(this.childNodes[a]):this.removeChild(a)};a.removeChildren=a.removeChildNodes=function(a){for(var c=a.length;c--;)"number"===typeof a[c]&&(a[c]=this.childNodes[a[c]]);for(n=a.length;c--;)this.removeChild(a[c])};a.innerHTML=function(a){this.innerHTML!==a&&(this.innerHTML=a)};a.dataset=function(a){for(var c in prop)element.dataset[c]=
prop[c]};Doom.modify=c})();Doom.remove=function(c,a){a?setTimeout(Doom.remove,a,c):c.parentNode&&c.parentNode.removeChild(c);return c};Doom.search=function(c,a){a=a||document;switch(c.charAt(0)){case ".":return a.getElementsByClassName(c.substr(1));case "#":return a.getElementById(c.substr(1));case "?":return a.querySelectorAll(c.substr(1));default:return a.getElementsByTagName(c)}};(function(){function c(a){function b(){g=null;h.x=null;h.y=null;h.t=null;d.event=null;d.gesture=null;d.pos_t_start=null;d.pos_t_previous=null;d.pos_t_end=null;d.pos_t_delta=null;d.pos_x_start=null;d.pos_x_previous=null;d.pos_x_end=null;d.pos_x_delta=null;d.pos_y_start=null;d.pos_y_previous=null;d.pos_y_end=null;d.pos_y_delta=null;d.pos_u_delta=null;d.vel_x=null;d.vel_y=null;d.vel_u=null;d.dist_x=null;d.dist_y=null;d.dist_u=null;d.direction=null;clearTimeout(t);t=null}function c(){h.x=g.pageX||g.changedTouches[0].pageX;
h.y=g.pageY||g.changedTouches[0].pageY;h.t=g.timeStamp}function f(a){g||(d.event=g=a,c(),d.pos_t_start=h.t,d.pos_x_start=h.x,d.pos_y_start=h.y,d.pos_t_delta=0,d.pos_x_delta=0,d.pos_y_delta=0,d.pos_u_delta=0,t=setTimeout(s,p.HOLD_MINTIME),m.event("touchstart",d))}function l(a){if(g){var b;d.event=g=a;d.pos_t_previous=h.t;d.pos_x_previous=h.x;d.pos_y_previous=h.y;c();d.pos_t_delta=h.t-d.pos_t_start;a=h.x-d.pos_x_previous;b=h.y-d.pos_y_previous;d.pos_x_delta+=Math.abs(a);d.pos_y_delta+=Math.abs(b);d.pos_u_delta+=
Math.sqrt(a*a+b*b);d.dist_x=h.x-d.pos_x_start;d.dist_y=h.y-d.pos_y_start;d.dist_u=Math.sqrt(d.dist_x*d.dist_x+d.dist_y*d.dist_y);d.vel_x=d.dist_x/d.pos_t_delta;d.vel_y=d.dist_y/d.pos_t_delta;d.vel_u=d.dist_u/d.pos_t_delta;m.event("touchmove",d);d.pos_u_delta>p.PAN_MINDELTA&&(Math.abs(d.dist_x)>Math.abs(d.dist_y)?(d.direction=0<a?"RIGHT":"LEFT",m.event("pan"+d.direction.toLowerCase(),d),m.event("panhorizontal",d)):(d.direction=0<b?"DOWN":"UP",m.event("pan"+d.direction.toLowerCase(),d),m.event("panvertical",
d)),m.event("pan",d))}}function k(a){if(g){var f;d.event=g=a;c();d.pos_t_end=h.t;d.pos_x_end=h.x;d.pos_y_end=h.y;d.pos_t_delta=h.t-d.pos_t_start;a=null===d.pos_x_previous?0:h.x-d.pos_x_previous;f=null===d.pos_y_previous?0:h.y-d.pos_y_previous;d.pos_x_delta+=Math.abs(a);d.pos_y_delta+=Math.abs(f);d.pos_u_delta+=Math.sqrt(a*a+f*f);d.dist_x=h.x-d.pos_x_start;d.dist_y=h.y-d.pos_y_start;d.dist_u=Math.sqrt(d.dist_x*d.dist_x+d.dist_y*d.dist_y);d.vel_x=d.dist_x/d.pos_t_delta;d.vel_y=d.dist_y/d.pos_t_delta;
d.vel_u=d.dist_u/d.pos_t_delta;m.event("touchend",d);"mouseleave"!==g.type&&"touchleave"!==g.type&&d.pos_t_delta<p.TAP_MAXTIME&&d.pos_u_delta<p.TAP_MAXDELTA&&(m.event("tap",d),p.PREVENT_DBL_CLICK&&g.preventDefault());d.pos_t_delta<p.SWIPE_MAXTIME&&d.vel_u>p.SWIPE_MINSPEED&&(Math.abs(d.dist_x)>Math.abs(d.dist_y)?(d.direction=0<d.dist_x?"RIGHT":"LEFT",m.event("swipe"+d.direction.toLowerCase(),d),m.event("swipehorizontal",d)):(d.direction=0<d.dist_y?"DOWN":"UP",m.event("swipe"+d.direction.toLowerCase(),
d),m.event("swipevertical",d)),m.event("swipe",d));b()}}function q(a){g&&p.END_ON_LEAVE&&k(a)}function s(){g&&(c(),d.pos_t_delta=h.t-d.pos_t_start,d.dist_u&&(d.vel_x=d.dist_x/d.pos_t_delta,d.vel_y=d.dist_y/d.pos_t_delta,d.vel_u=d.dist_u/d.pos_t_delta),d.pos_u_delta<p.HOLD_MAXDELTA&&m.event("hold",d))}var m=this,g=null,t=null,r=a.style,p={TAP_MAXTIME:500,TAP_MAXDELTA:20,PAN_MINDELTA:20,HOLD_MINTIME:1E3,HOLD_MAXDELTA:20,SWIPE_MAXTIME:400,SWIPE_MINSPEED:1,END_ON_LEAVE:!1,PREVENT_DBL_CLICK:!1,TOUCH:"ontouchstart"in
window,MOUSE:!0},h={x:null,y:null,t:null},d={pos:h,event:null,preventDefault:function(){g&&g.cancellable&&g.preventDefault()},stopProgagation:function(){g&&g.stopProgagation&&g.stopProgagation()},childIndex:function(b){b=b||a;for(var c=-1,d=0,e=b.children.length;d<e;d++)if(b.children[d].contains(g.target)){c=d;break}return c},childNode:function(b){b=b||a;for(var c,d=0,e=b.children.length;d<e;d++)if(b.children[d].contains(g.target)){c=b.children[d];break}return c},element:a};this.detach=function(){p.TOUCH&&
(a.removeEventListener("touchstart",f,!1),a.removeEventListener("touchmove",l,!1),document.body.removeEventListener("touchcancel",k,!1),document.body.removeEventListener("touchend",k,!1),a.removeEventListener("touchleave",q,!1));p.MOUSE&&(a.removeEventListener("mousedown",f,!1),a.removeEventListener("mousemove",l,!1),document.body.removeEventListener("mouseup",k,!1),a.removeEventListener("mouseleave",q,!1))};this.attach=function(){p.TOUCH&&(a.addEventListener("touchstart",f,!1),a.addEventListener("touchmove",
l,!1),document.body.addEventListener("touchcancel",k,!1),document.body.addEventListener("touchend",k,!1),a.addEventListener("touchleave",q,!1));p.MOUSE&&(a.addEventListener("mousedown",f,!1),a.addEventListener("mousemove",l,!1),document.body.addEventListener("mouseup",k,!1),a.addEventListener("mouseleave",q,!1))};r.webkitUserSelect="none";r.mozUserSelect="none";r.msUserSelect="none";r.webkitUserDrag="none";r.webkitTapHighlightColor="rgba(0,0,0,0)";b();this.attach();this.__eventlist__={};this.element=
a;this.CONFIG=p;a.touches=this}c.prototype={on:function(a,b){"tap"===a&&(this.CONFIG.PREVENT_DBL_CLICK=!0);this.__eventlist__[a.toLowerCase()]=b},event:function(a,b){if("function"===typeof this.__eventlist__[a]){b.gesture=a;try{this.__eventlist__[a].call(this,b)}catch(c){console.error(c.stack||c)}}}};Doom.touch=function(a,b,e){a.touches||new c(a);if(b&&b.constructor===Array)for(var f=0,l=b.length;f<l;f++)a.touches.on(b[f],e);else a.touches.on(b,e);return a.touches}})();})();
